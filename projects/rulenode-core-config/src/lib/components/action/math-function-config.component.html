<section [formGroup]="mathFunctionConfigForm" fxLayout="column">
  <tb-math-function-autocomplete
    fxFlex="30" fxFlex.md fxFlex.xs
    required
    formControlName="operation">
  </tb-math-function-autocomplete>
  <fieldset class="fields-group" fxLayout="column" fxLayoutGap="8px">
    <legend class="group-title" translate>tb.rulenode.argument-tile</legend>
    <tb-arguments-map-config formControlName="arguments"
                             [function]="mathFunctionConfigForm.get('operation').value">
    </tb-arguments-map-config>
  </fieldset>
  <mat-form-field fxFlex floatLabel="always" hideRequiredMarker class="cell mat-block"
                  style="margin-top: 10px"
                  *ngIf="mathFunctionConfigForm.get('operation').value === 'CUSTOM'">
    <mat-label translate>tb.rulenode.custom-expression-field-input</mat-label>
    <input matInput formControlName="customFunction" required/>
    <mat-error *ngIf="mathFunctionConfigForm.get('customFunction').hasError('required')" translate>
      tb.rulenode.custom-expression-field-input-required
    </mat-error>
  </mat-form-field>
  <fieldset class="fields-group" fxLayout="column" fxLayoutGap="8px">
    <legend class="group-title" translate>tb.rulenode.result-title</legend>
    <div formGroupName="result">
      <div fxFlex fxLayout="row" fxLayout.xs="column" fxLayoutGap.gt-xs="16px">
        <mat-form-field fxFlex class="mat-block">
          <mat-label translate>tb.rulenode.type-field-input</mat-label>
          <mat-select formControlName="type" required>
            <mat-option *ngFor="let argument of argumentsResult" [value]="argument">
              {{ argumentTypeResultMap.get(argument) | translate }}
            </mat-option>
          </mat-select>
          <mat-error *ngIf="mathFunctionConfigForm.get('result.type').hasError('required')" translate>
            tb.rulenode.type-field-input-required
          </mat-error>
        </mat-form-field>
        <mat-form-field fxFlex class="mat-block" *ngIf="mathFunctionConfigForm.get('result').get('type').value === ArgumentTypeResult.ATTRIBUTE">
          <mat-label translate>tb.rulenode.attribute-scope-field-input</mat-label>
          <mat-select formControlName="attributeScope">
            <mat-option *ngFor="let scope of attributeScopeResult" [value]="scope">
              {{ attributeScopeMap.get(scope) | translate }}
            </mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field fxFlex floatLabel="always" hideRequiredMarker class="cell mat-block">
          <mat-label translate>tb.rulenode.key-field-input</mat-label>
          <input matInput formControlName="key" required/>
          <mat-error *ngIf="mathFunctionConfigForm.get('result.key').hasError('required')" translate>
            tb.rulenode.key-field-input-required
          </mat-error>
        </mat-form-field>
      </div>
      <div fxFlex fxLayout="row" fxLayout.xs="column" fxLayoutGap.gt-xs="16px">
        <mat-form-field fxFlex floatLabel="always" hideRequiredMarker class="cell mat-block">
          <mat-label translate>tb.rulenode.number-floating-point-field-input</mat-label>
          <input formControlName="resultValuePrecision"
                 matInput
                 step="1" min="0"
                 type="number"/>
        </mat-form-field>
        <div fxFlex></div>
      </div>
      <div fxFlex fxLayout="row" fxLayout.xs="column" fxLayoutAlign="start" fxLayoutGap.gt-xs="16px">
        <mat-checkbox *ngIf="mathFunctionConfigForm.get('result').get('type').value !== ArgumentTypeResult.MESSAGE_BODY" formControlName="addToBody" style="padding-bottom: 16px;">
          {{'tb.rulenode.add-to-body-field-input' | translate }}
        </mat-checkbox>
        <mat-checkbox *ngIf="mathFunctionConfigForm.get('result').get('type').value !== ArgumentTypeResult.MESSAGE_METADATA" formControlName="addToMetadata" style="padding-bottom: 16px;">
          {{'tb.rulenode.add-to-metadata-field-input' | translate}}
        </mat-checkbox>
      </div>
    </div>
  </fieldset>
</section>
