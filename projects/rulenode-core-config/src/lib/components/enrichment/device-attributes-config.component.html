<section [formGroup]="deviceAttributesConfigForm" fxLayout="column">
  <label translate class="tb-title tb-required">tb.rulenode.device-relations-query</label>
  <tb-device-relations-query-config
    required
    formControlName="deviceRelationsQuery"
    style="padding-bottom: 15px;">
  </tb-device-relations-query-config>
  <mat-checkbox fxFlex formControlName="tellFailureIfAbsent">
    {{ 'tb.rulenode.tell-failure-if-absent' | translate }}
  </mat-checkbox>
  <div class="tb-hint" translate>tb.rulenode.tell-failure-if-absent-hint</div>
  <div class="mat-caption" style="margin-bottom: 8px;">{{ 'tb.rulenode.fetch-into' | translate }}</div>
  <mat-radio-group style="padding-bottom: 15px;" formControlName="fetchToData" fxLayout="row" fxLayoutGap="16px">
    <mat-radio-button [value]="true" color="primary" >
      <span>{{ 'tb.rulenode.data' | translate }}</span>
    </mat-radio-button>
    <mat-radio-button [value]="false" color="primary">
      <span>{{ 'tb.rulenode.metadata' | translate }}</span>
    </mat-radio-button>
  </mat-radio-group>
  <mat-form-field class="mat-block">
    <mat-label translate>tb.rulenode.client-attributes</mat-label>
    <mat-chip-grid #clientAttributesChipList>
      <mat-chip-row
        *ngFor="let key of deviceAttributesConfigForm.get('clientAttributeNames').value;"
        (removed)="removeKey(key, 'clientAttributeNames')">
        {{key}}
        <mat-icon matChipRemove>close</mat-icon>
      </mat-chip-row>
      <input matInput type="text" placeholder="{{'tb.rulenode.client-attributes' | translate}}"
             [matChipInputFor]="clientAttributesChipList"
             [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
             (matChipInputTokenEnd)="addKey($event, 'clientAttributeNames')"
             [matChipInputAddOnBlur]="true">
    </mat-chip-grid>
  </mat-form-field>
  <mat-form-field class="mat-block">
    <mat-label translate>tb.rulenode.shared-attributes</mat-label>
    <mat-chip-grid #sharedAttributesChipList>
      <mat-chip-row
        *ngFor="let key of deviceAttributesConfigForm.get('sharedAttributeNames').value;"
        (removed)="removeKey(key, 'sharedAttributeNames')">
        {{key}}
        <mat-icon matChipRemove>close</mat-icon>
      </mat-chip-row>
      <input matInput type="text" placeholder="{{'tb.rulenode.shared-attributes' | translate}}"
             [matChipInputFor]="sharedAttributesChipList"
             [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
             (matChipInputTokenEnd)="addKey($event, 'sharedAttributeNames')"
             [matChipInputAddOnBlur]="true">
    </mat-chip-grid>
  </mat-form-field>
  <mat-form-field class="mat-block">
    <mat-label translate>tb.rulenode.server-attributes</mat-label>
    <mat-chip-grid #serverAttributesChipList>
      <mat-chip-row
        *ngFor="let key of deviceAttributesConfigForm.get('serverAttributeNames').value;"
        (removed)="removeKey(key, 'serverAttributeNames')">
        {{key}}
        <mat-icon matChipRemove>close</mat-icon>
      </mat-chip-row>
      <input matInput type="text" placeholder="{{'tb.rulenode.server-attributes' | translate}}"
             [matChipInputFor]="serverAttributesChipList"
             [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
             (matChipInputTokenEnd)="addKey($event, 'serverAttributeNames')"
             [matChipInputAddOnBlur]="true">
    </mat-chip-grid>
  </mat-form-field>
  <mat-form-field class="mat-block">
    <mat-label translate>tb.rulenode.latest-timeseries</mat-label>
    <mat-chip-grid #latestTimeseriesChipList>
      <mat-chip-row
        *ngFor="let key of deviceAttributesConfigForm.get('latestTsKeyNames').value;"
        (removed)="removeKey(key, 'latestTsKeyNames')">
        {{key}}
        <mat-icon matChipRemove>close</mat-icon>
      </mat-chip-row>
      <input matInput type="text" placeholder="{{'tb.rulenode.latest-timeseries' | translate}}"
             [matChipInputFor]="latestTimeseriesChipList"
             [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
             (matChipInputTokenEnd)="addKey($event, 'latestTsKeyNames')"
             [matChipInputAddOnBlur]="true">
    </mat-chip-grid>
  </mat-form-field>
  <mat-checkbox formControlName="getLatestValueWithTs">
    {{ 'tb.rulenode.get-latest-value-with-ts' | translate }}
  </mat-checkbox>
  <div class="tb-hint" [innerHTML]="'tb.rulenode.get-latest-value-with-ts-hint' | translate | safeHtml"></div>
</section>
