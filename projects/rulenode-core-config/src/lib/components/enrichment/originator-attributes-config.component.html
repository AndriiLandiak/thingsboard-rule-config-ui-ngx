<section [formGroup]="originatorAttributesConfigForm" fxLayout="column">
  <tb-fieldset-component label="tb.rulenode.originator-attributes" required="true">
    <ng-template tbAppWidgetContentTemplate>
      <mat-form-field class="mat-block chip-grid" subscriptSizing="dynamic">
        <mat-label translate>tb.rulenode.client-attributes</mat-label>
        <mat-chip-grid #clientAttributesChipList>
          <mat-chip-row
            *ngFor="let key of originatorAttributesConfigForm.get('clientAttributeNames').value;"
            (removed)="removeKey(key, 'clientAttributeNames')">
            {{key}}
            <mat-icon matChipRemove>close</mat-icon>
          </mat-chip-row>
          <input matInput type="text" placeholder="{{'tb.rulenode.client-attributes' | translate}}"
                 [matChipInputFor]="clientAttributesChipList"
                 [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                 (matChipInputTokenEnd)="addKey($event, 'clientAttributeNames')"
                 [matChipInputAddOnBlur]="true">
        </mat-chip-grid>
        <button *ngIf="originatorAttributesConfigForm.get('clientAttributeNames').value?.length > 1"
                type="button"
                style="margin-right: 3px"
                matTooltip="{{'tb.rulenode.clear-selected-details' | translate}}"
                matSuffix mat-icon-button
                (click)="clearChipGrid('clientAttributeNames')">
          <mat-icon color="primary" class="material-icons">close</mat-icon>
        </button>
      </mat-form-field>
      <mat-form-field class="mat-block chip-grid" subscriptSizing="dynamic">
        <mat-label translate>tb.rulenode.shared-attributes</mat-label>
        <mat-chip-grid #sharedAttributesChipList>
          <mat-chip-row
            *ngFor="let key of originatorAttributesConfigForm.get('sharedAttributeNames').value;"
            (removed)="removeKey(key, 'sharedAttributeNames')">
            {{key}}
            <mat-icon matChipRemove>close</mat-icon>
          </mat-chip-row>
          <input matInput type="text" placeholder="{{'tb.rulenode.shared-attributes' | translate}}"
                 [matChipInputFor]="sharedAttributesChipList"
                 [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                 (matChipInputTokenEnd)="addKey($event, 'sharedAttributeNames')"
                 [matChipInputAddOnBlur]="true">
        </mat-chip-grid>
        <button *ngIf="originatorAttributesConfigForm.get('sharedAttributeNames').value?.length > 1"
                type="button"
                style="margin-right: 3px"
                matTooltip="{{'tb.rulenode.clear-selected-details' | translate}}"
                matSuffix mat-icon-button
                (click)="clearChipGrid('sharedAttributeNames')">
          <mat-icon color="primary" class="material-icons">close</mat-icon>
        </button>
      </mat-form-field>
      <mat-form-field class="mat-block chip-grid" subscriptSizing="dynamic">
        <mat-label translate>tb.rulenode.server-attributes</mat-label>
        <mat-chip-grid #serverAttributesChipList>
          <mat-chip-row
            *ngFor="let key of originatorAttributesConfigForm.get('serverAttributeNames').value;"
            (removed)="removeKey(key, 'serverAttributeNames')">
            {{key}}
            <mat-icon matChipRemove>close</mat-icon>
          </mat-chip-row>
          <input matInput type="text" placeholder="{{'tb.rulenode.server-attributes' | translate}}"
                 [matChipInputFor]="serverAttributesChipList"
                 [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                 (matChipInputTokenEnd)="addKey($event, 'serverAttributeNames')"
                 [matChipInputAddOnBlur]="true">
        </mat-chip-grid>
      </mat-form-field>
      <button *ngIf="originatorAttributesConfigForm.get('serverAttributeNames').value?.length > 1"
              type="button"
              style="margin-right: 3px"
              matTooltip="{{'tb.rulenode.clear-selected-details' | translate}}"
              matSuffix mat-icon-button
              (click)="clearChipGrid('serverAttributeNames')">
        <mat-icon color="primary" class="material-icons">close</mat-icon>
      </button>
      <mat-form-field class="mat-block chip-grid" subscriptSizing="dynamic">
        <mat-label translate>tb.rulenode.latest-timeseries</mat-label>
        <mat-chip-grid #latestTimeseriesChipList>
          <mat-chip-row
            *ngFor="let key of originatorAttributesConfigForm.get('latestTsKeyNames').value;"
            (removed)="removeKey(key, 'latestTsKeyNames')">
            {{key}}
            <mat-icon matChipRemove>close</mat-icon>
          </mat-chip-row>
          <input matInput type="text" placeholder="{{'tb.rulenode.latest-timeseries' | translate}}"
                 [matChipInputFor]="latestTimeseriesChipList"
                 [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                 (matChipInputTokenEnd)="addKey($event, 'latestTsKeyNames')"
                 [matChipInputAddOnBlur]="true">
        </mat-chip-grid>
        <button *ngIf="originatorAttributesConfigForm.get('latestTsKeyNames').value?.length > 1"
                type="button"
                style="margin-right: 3px"
                matTooltip="{{'tb.rulenode.clear-selected-details' | translate}}"
                matSuffix mat-icon-button
                (click)="clearChipGrid('latestTsKeyNames')">
          <mat-icon color="primary" class="material-icons">close</mat-icon>
        </button>
      </mat-form-field>
      <div class="tb-hint">
        <span style="vertical-align: middle">{{ 'tb.rulenode.kv-map-pattern-hint' | translate }}</span>
        <span tb-help-popup="{{'rulenode/customer_attributes_node_fn'}}"
             tb-help-popup-placement="right"  class="examples-popup"
             trigger-style="letter-spacing:0.25px; font-size:12px"
             [tb-help-popup-style]="{maxWidth: '820px'}"
             trigger-text="{{ 'tb.key-val.see-examples' | translate }}"></span>
      </div>
      <tb-slide-toggle *ngIf="originatorAttributesConfigForm.get('latestTsKeyNames').value?.length > 0"
                       class="fetch-slide-toggle" formControlName="getLatestValueWithTs"
                       slideToggleName="tb.rulenode.fetch-latest-telemetry-with-timestamp"
                       slideToggleTooltip="tb.rulenode.fetch-latest-telemetry-with-timestamp-tooltip">
      </tb-slide-toggle>
    </ng-template>
  </tb-fieldset-component>
  <tb-slide-toggle class="failure-slide-toggle" formControlName="tellFailureIfAbsent"
                   slideToggleName="tb.rulenode.tell-failure"
                   slideToggleTooltip="tb.rulenode.tell-failure-tooltip">
  </tb-slide-toggle>
  <tb-msg-metadata-chip
    labelText="tb.rulenode.add-originator-attributes-to"
    formControlName="fetchTo"
  ></tb-msg-metadata-chip>
</section>
