<section [formGroup]="entityDetailsConfigForm" fxLayout="column">
  <mat-form-field class="mat-block" class="entity-fields-list">
    <mat-label translate>tb.rulenode.entity-details</mat-label>
    <mat-chip-grid #detailsChipList formControlName="detailsList">
      <mat-chip-row
        *ngFor="let details of detailsList;"
        (removed)="removeDetailsField(details)">
        <span>
          <strong>{{entityDetailsTranslationsMap.get(details) | translate}}</strong>
        </span>
        <mat-icon matChipRemove>close</mat-icon>
      </mat-chip-row>
      <input matInput type="text"
             #detailsInput
             (focusin)="onEntityDetailsInputFocus()"
             [formControl]="detailsFormControl"
             matAutocompleteOrigin
             #origin="matAutocompleteOrigin"
             [matAutocompleteConnectedTo]="origin"
             [matAutocomplete]="detailsAutocomplete"
             [matChipInputFor]="detailsChipList">
    </mat-chip-grid>
    <button *ngIf="entityDetailsConfigForm.get('detailsList').value?.length > 1"
            type="button"
            style="margin-right: 3px"
            matTooltip="{{'tb.rulenode.clear-selected-details' | translate}}"
            matSuffix mat-icon-button
            (click)="clearChipGrid()">
      <mat-icon color="primary" class="material-icons">close</mat-icon>
    </button>
    <mat-autocomplete #detailsAutocomplete="matAutocomplete"
                      class="tb-autocomplete"
                      (optionSelected)="detailsFieldSelected($event)"
                      [displayWith]="displayDetailsFn">
      <mat-option *ngFor="let details of filteredEntityDetails | async" [value]="details">
        <span [innerHTML]="entityDetailsTranslationsMap.get(details) | translate | highlight:searchText"></span>
      </mat-option>
      <mat-option *ngIf="(filteredEntityDetails | async)?.length === 0" [value]="null" class="tb-not-found">
        <div class="tb-not-found-content" (click)="$event.stopPropagation()">
          <div>
            <span translate>tb.rulenode.no-entity-details-matching</span>
          </div>
        </div>
      </mat-option>
    </mat-autocomplete>
    <mat-error *ngIf="entityDetailsConfigForm.get('detailsList').hasError('required')">{{ 'tb.rulenode.entity-details-list-empty' | translate }}</mat-error>
  </mat-form-field>
  <tb-msg-metadata-chip
    labelText="tb.rulenode.add-selected-details-to"
    formControlName="fetchTo"
  ></tb-msg-metadata-chip>
</section>
